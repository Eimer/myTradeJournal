import{a as L,c as V,d as B}from"./chunk-XCIS2ETL.js";import{a as $,b as m,c as z,d as G,e as Y,f as H,g as J,h as K,i as Q,j as W,k as X,l as Z,m as ee,n as te,o as ne,p as ie,q as re,r as oe,s as ae,t as se}from"./chunk-WQD7JJFC.js";import{d as P,e as T,l as q,n as y,o as U}from"./chunk-IOQO7AVL.js";import{B as E,Ib as a,Ja as l,Jb as _,K as N,L as d,Lb as w,Mb as I,P as j,U as u,Wa as A,Za as F,ba as h,e as k,h as O,ib as p,jb as f,k as x,kb as v,lb as r,mb as o,nb as b,tb as M,ub as R,w as c}from"./chunk-XEMNNBHJ.js";var S=class t{_apiService=u(V);_userService=u(B);_router=u(y);constructor(){}signIn(e,i){return this._apiService.signIn(e,i).pipe(d(n=>{if(n&&n.user){let s=n.user;this._userService.setUser({id:s.id,email:s.email,displayName:s.user_metadata?.display_name||"Trader"})}}),c(n=>x(()=>n)))}signUp(e,i,n){return this._apiService.signUp(e,i,n).pipe(d(s=>{console.log("Sign up success:",s)}),c(s=>x(()=>s)))}logout(){return this._apiService.signOut().pipe(E(()=>{this._userService.setLoggedOut(),this._router.navigate(["/login"])}))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})};function D(t){t||(t=u(h));let e=new k(i=>{if(t.destroyed){i.next();return}return t.onDestroy(i.next.bind(i))});return i=>i.pipe(N(e))}var C=class t{transform(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}static \u0275fac=function(i){return new(i||t)};static \u0275pipe=F({name:"capitalize",type:t,pure:!0})};var me=["class","component"];function ce(t,e){t&1&&a(0," Loggin in ")}function de(t,e){t&1&&a(0," Create an account ")}function pe(t,e){t&1&&(r(0,"mat-form-field",4)(1,"mat-label"),a(2,"Your name"),o(),b(3,"input",12),r(4,"mat-icon",6),a(5,"person"),o()())}function fe(t,e){if(t&1&&(r(0,"div",9),a(1),o()),t&2){let i=R();l(),_(i.errorMessage)}}function ge(t,e){t&1&&(r(0,"span",13),a(1,"Not registered? "),o(),r(2,"a",14),a(3,"Create an account"),o())}function he(t,e){t&1&&(r(0,"span",13),a(1,"Already have an account? "),o(),r(2,"a",15),a(3,"Log in"),o())}var le=class t{loaderService=u(L);_route=u(q);_router=u(y);_authService=u(S);_fb=u(K);authState={state:"login"};errorMessage=null;hidePassword=!0;_destroyRef=u(h);authForm=this._fb.group({email:["",[m.required,m.email]],password:["",[m.required,m.minLength(6)]],displayName:[""]});constructor(){this._route.url.pipe(D()).subscribe(e=>{this.authState.state=e[0].path==="login"?"login":"register",this.updateValidators()})}ngOnInit(){}onSubmit(){if(this.authForm.invalid)return;this.errorMessage=null;let{email:e,password:i,displayName:n}=this.authForm.getRawValue();(this.authState.state==="login"?this._authService.signIn(e,i):this._authService.signUp(e,i,n)).pipe(d(()=>{this._router.navigate(["/home"])}),c(g=>(this.errorMessage=g.message||"Auth error",O)),D(this._destroyRef)).subscribe()}updateValidators(){let e=this.authForm.controls.displayName;this.authState.state==="login"?e.clearValidators():e.setValidators([m.required]),e.updateValueAndValidity()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=A({type:t,selectors:[["auth",8,"component"]],attrs:me,decls:29,vars:13,consts:[[1,"auth-page"],[1,"auth-page__container"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"auth-form__title"],["appearance","outline",1,"auth-form__field"],["matInput","","formControlName","email","type","email","placeholder","trade@example.com"],["matSuffix",""],["matInput","","formControlName","password",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],[1,"auth-form__error"],["matButton","filled","color","primary","type","submit",1,"auth-form__submit-btn",3,"disabled"],[1,"auth-form__footer"],["matInput","","formControlName","displayName","placeholder","Your name"],[1,"auth-form__footer-text"],["routerLink","/register",1,"auth-form__link"],["routerLink","/login",1,"auth-form__link"]],template:function(i,n){if(i&1&&(r(0,"div",0)(1,"div",1)(2,"form",2),M("ngSubmit",function(){return n.onSubmit()}),r(3,"h2",3),p(4,ce,1,0)(5,de,1,0),o(),p(6,pe,6,0,"mat-form-field",4),r(7,"mat-form-field",4)(8,"mat-label"),a(9,"Email"),o(),b(10,"input",5),r(11,"mat-icon",6),a(12,"email"),o()(),r(13,"mat-form-field",4)(14,"mat-label"),a(15,"Password"),o(),b(16,"input",7),r(17,"button",8),M("click",function(){return n.hidePassword=!n.hidePassword}),r(18,"mat-icon"),a(19),o()()(),p(20,fe,2,1,"div",9),r(21,"button",10),w(22,"async"),r(23,"span"),a(24),w(25,"capitalize"),o()(),r(26,"div",11),p(27,ge,4,0)(28,he,4,0),o()()()()),i&2){let s,g;l(2),v("formGroup",n.authForm),l(2),f((s=n.authState.state)==="login"?4:s==="register"?5:-1),l(2),f(n.authState.state==="register"?6:-1),l(10),v("type",n.hidePassword?"password":"text"),l(3),_(n.hidePassword?"visibility_off":"visibility"),l(),f(n.errorMessage?20:-1),l(),v("disabled",n.authForm.invalid||I(22,9,n.loaderService.isLoading$)),l(3),_(I(25,11,n.authState.state)),l(3),f((g=n.authState.state)==="login"?27:g==="register"?28:-1)}},dependencies:[T,Q,Y,$,z,G,J,H,U,ee,Z,W,X,ne,te,oe,re,ie,se,ae,P,C],styles:[".auth-page[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.auth-page__container[_ngcontent-%COMP%]{width:90%;max-width:540px;padding:1em;border-radius:15px;border:1px solid rgba(83,83,83,.3254901961)}.auth-page__container[_ngcontent-%COMP%]   .auth-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1em}"]})};export{le as AuthComponent};
