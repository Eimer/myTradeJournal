import{g as b,h as v}from"./chunk-MKRY7W2U.js";import{P as p,T as r,Y as n,a as h,b as d,e as g,g as i,i as m}from"./chunk-D3UJV3R7.js";var f=class s{_loading$=new i(!1);isLoading$=this._loading$.asObservable();_activeRequests=0;show(){this._activeRequests++,this._loading$.next(!0)}hide(){this._activeRequests--,this._activeRequests<=0&&(this._activeRequests=0,this._loading$.next(!1))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=r({token:s,factory:s.\u0275fac,providedIn:"root"})};var l={production:!0,supabaseUrl:"https://riubhgjqveurikxrrqet.supabase.co",supabaseKey:"sb_publishable_2FhFguJkLCP2kzZXu9PR0Q_xafKB4D4"};var c=class s{_http=n(v);url=l.supabaseUrl;key=l.supabaseKey;headers=new b({apikey:this.key,"Content-Type":"application/json"});constructor(){}signUp(e,t,u){let a={email:e,password:t,data:{display_name:u}};return this._http.post(`${this.url}/auth/v1/signup`,a,{headers:this.headers})}signIn(e,t){let u={email:e,password:t};return this._http.post(`${this.url}/auth/v1/token?grant_type=password`,u,{headers:this.headers}).pipe(p(a=>{a.access_token&&(localStorage.setItem("sb-access-token",a.access_token),localStorage.setItem("sb-refresh-token",a.refresh_token))}))}signOut(){let e=localStorage.getItem("sb-access-token"),t=this.headers.set("Authorization",`Bearer ${e}`);return this._http.post(`${this.url}/auth/v1/logout`,{},{headers:t}).pipe(p(()=>{localStorage.removeItem("sb-access-token"),localStorage.removeItem("sb-refresh-token")}))}getUser(){let e=localStorage.getItem("sb-access-token");if(!e)return m([null]);let t=this.headers.set("Authorization",`Bearer ${e}`);return this._http.get(`${this.url}/auth/v1/user`,{headers:t})}getSession(){let e=localStorage.getItem("sb-access-token");return new g(t=>{t.next(e?{access_token:e}:null),t.complete()})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=r({token:s,factory:s.\u0275fac,providedIn:"root"})};var o={waitAuth:"wait-auth",loggedIn:"logged-in",loggedOut:"logged-out"};var k=class s{_user$=new i({status:o.waitAuth});user$=this._user$.asObservable();_apiService=n(c);constructor(){}loadUser(){if(!localStorage.getItem("sb-access-token")){this.setLoggedOut();return}this._apiService.getUser().subscribe({next:t=>{this.setUser({id:t.id,email:t.email,displayName:t.user_metadata?.display_name||"Trader"})},error:()=>{this.setLoggedOut(),localStorage.clear()}})}setUser(e){this._user$.next(d(h({},e),{status:o.loggedIn}))}setLoggedOut(){this._user$.next({status:o.loggedOut}),localStorage.removeItem("sb-access-token"),localStorage.removeItem("sb-refresh-token")}getCurrentStatus(){return this._user$.getValue().status||o.waitAuth}static \u0275fac=function(t){return new(t||s)};static \u0275prov=r({token:s,factory:s.\u0275fac,providedIn:"root"})};export{f as a,o as b,c,k as d};
