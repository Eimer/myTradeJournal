import{f as x,g as w,m as j}from"./chunk-UJAUFW42.js";import{F as S,O as k,P as a,T as i,Y as o,a as g,b,e as l,fa as I,g as d,i as y,k as m,y as v}from"./chunk-644IJ2L6.js";var O=class r{_loading$=new d(!1);isLoading$=this._loading$.asObservable();_activeRequests=0;show(){this._activeRequests++,this._loading$.next(!0)}hide(){this._activeRequests--,this._activeRequests<=0&&(this._activeRequests=0,this._loading$.next(!1))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var c={waitAuth:"wait-auth",loggedIn:"logged-in",loggedOut:"logged-out"};var h={production:!0,supabaseUrl:"https://riubhgjqveurikxrrqet.supabase.co",supabaseKey:"sb_publishable_2FhFguJkLCP2kzZXu9PR0Q_xafKB4D4"};var u=class r{_http=o(w);url=h.supabaseUrl;key=h.supabaseKey;headers=new x({apikey:this.key,"Content-Type":"application/json"});constructor(){}signUp(t,e,s){let n={email:t,password:e,data:{display_name:s}};return this._http.post(`${this.url}/auth/v1/signup`,n,{headers:this.headers})}signIn(t,e){let s={email:t,password:e};return this._http.post(`${this.url}/auth/v1/token?grant_type=password`,s,{headers:this.headers}).pipe(a(n=>{n.access_token&&(localStorage.setItem("sb-access-token",n.access_token),localStorage.setItem("sb-refresh-token",n.refresh_token))}))}signOut(){let t=localStorage.getItem("sb-access-token"),e=this.headers.set("Authorization",`Bearer ${t}`);return this._http.post(`${this.url}/auth/v1/logout`,{},{headers:e}).pipe(a(()=>{localStorage.removeItem("sb-access-token"),localStorage.removeItem("sb-refresh-token")}))}getUser(){let t=localStorage.getItem("sb-access-token");if(!t)return y([null]);let e=this.headers.set("Authorization",`Bearer ${t}`);return this._http.get(`${this.url}/auth/v1/user`,{headers:e})}getSession(){let t=localStorage.getItem("sb-access-token");return new l(e=>{e.next(t?{access_token:t}:null),e.complete()})}static \u0275fac=function(e){return new(e||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var p=class r{_user$=new d({status:c.waitAuth});user$=this._user$.asObservable();_apiService=o(u);constructor(){}loadUser(){if(!localStorage.getItem("sb-access-token")){this.setLoggedOut();return}this._apiService.getUser().subscribe({next:e=>{this.setUser({id:e.id,email:e.email,displayName:e.user_metadata?.display_name||"Trader"})},error:()=>{this.setLoggedOut(),localStorage.clear()}})}setUser(t){this._user$.next(b(g({},t),{status:c.loggedIn}))}setLoggedOut(){this._user$.next({status:c.loggedOut}),localStorage.removeItem("sb-access-token"),localStorage.removeItem("sb-refresh-token")}getCurrentStatus(){return this._user$.getValue().status||c.waitAuth}static \u0275fac=function(e){return new(e||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};var _=class r{_apiService=o(u);_userService=o(p);_router=o(j);constructor(){}signIn(t,e){return this._apiService.signIn(t,e).pipe(a(s=>{if(s&&s.user){let n=s.user;this._userService.setUser({id:n.id,email:n.email,displayName:n.user_metadata?.display_name||"Trader"})}}),v(s=>m(()=>s)))}signUp(t,e,s){return this._apiService.signUp(t,e,s).pipe(a(n=>{console.log("Sign up success:",n)}),v(n=>m(()=>n)))}logout(){return this._apiService.signOut().pipe(S(()=>{this._userService.setLoggedOut(),this._router.navigate(["/login"])}))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=i({token:r,factory:r.\u0275fac,providedIn:"root"})};function fe(r){r||(r=o(I));let t=new l(e=>{if(r.destroyed){e.next();return}return r.onDestroy(e.next.bind(e))});return e=>e.pipe(k(t))}export{O as a,c as b,p as c,_ as d,fe as e};
